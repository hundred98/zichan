<!DOCTYPE html>
<html>
<head>
    <meta charset="gb2312">
    <title>实物资产管理系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../layui/css/layui.css">

    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>

<body>
<script src="../layui/layui.js"></script>
<script src="../layui/res/js/cookie.js"></script>

<h1>资产基本信息管理</h1>
<!--form name="lc" class="layui-form col-lg-5" action="/shiwuzichan/YW_guanli/zc_ly/" method="post"> -->
<div class="demoTable layui-form">
	<input type="hidden" name="zc_num" id="zc_num">
	
	<table class="layui-table" lay-size="sm" style="table-layout:fixed">
		<colgroup>
			<col width="40">
			<col width="100">
			<col width="10">
			<col width="40">
			<col width="100">
		</colgroup>
		<tbody>
			<tr>
				<td><label width="40" class="layui-form-label">资产名称:</label></td>
				<td><input class="layui-input" name="mingcheng" id="mingcheng" style="width:180px;height:30px;"></td>
				<td> </td>
				<td><label width="40" class="layui-form-label">资产名称:</label></td>
				<td><input class="layui-input" name="mingcheng_a" id="mingcheng_a" style="width:180px;height:30px;"></td>
			</tr>
			<tr>
				<td><label class="layui-form-label">一级类别:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="yjleibie" id="yjleibie" lay-filter="yjleibie">
							<option value="">请选择一级类别</option>
						</select>
					</div>
				</td>
				<td> </td>
				<td><label class="layui-form-label">一级类别:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="yjleibie_a" id="yjleibie_a" lay-filter="yjleibie_a">
							<option value="">请选择一级类别</option>
						</select>
					</div>
				</td>				
			</tr>

			<tr>
				<td><label class="layui-form-label">二级类别:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="ejleibie" id="ejleibie" disabled>
							<option value="">请选择二级类别</option>
						</select>
					</div>
				</td>
				<td> </td>
				<td><label class="layui-form-label">二级类别:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="ejleibie_a" id="ejleibie_a" disabled>
							<option value="">请选择二级类别</option>
						</select>
					</div>
				</td>
			</tr>

			<tr>
				<td><label class="layui-form-label">生产商:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="shchsh" id="shchsh" lay-filter="shchsh">
							<option value="">请选择生产商</option>
						</select>
					</div>
				</td>
				<td> </td>
				<td><label class="layui-form-label">生产商:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="shchsh_a" id="shchsh_a" lay-filter="shchsh_a">
							<option value="">请选择生产商</option>
						</select>
					</div>
				</td>
			</tr>

			<tr>
				<td><label class="layui-form-label">品牌/名称:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="pinpai" id="pinpai" lay-filter="pinpai" disabled>
							<option value="">请选择品牌/名称</option>
						</select>
					</div>
				</td>
				<td> </td>
				<td><label class="layui-form-label">品牌/名称:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="pinpai_a" id="pinpai_a" lay-filter="pinpai_a" disabled>
							<option value="">请选择品牌/名称</option>
						</select>
					</div>
				</td>
			</tr>

			<tr>
				<td><label class="layui-form-label">型号:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="xinghao" id="xinghao" disabled>
							<option value="">请选择型号</option>
						</select>
					</div>
				</td>
				<td> </td>
				<td><label class="layui-form-label">型号:</label></td>
				<td>
					<div class="layui-input-inline">
						<select name="xinghao_a" id="xinghao_a" disabled>
							<option value="">请选择型号</option>
						</select>
					</div>
				</td>
			</tr>

			<tr>
				<td><label class="layui-form-label">备注:</label></td>
				<td><input class="layui-input" name="beizhu" id="beizhu" style="width:180px;height:30px;"></td>
				<td> </td>
				<td><label class="layui-form-label">备注:</label></td>
				<td><input class="layui-input" name="beizhu_a" id="beizhu_a" style="width:180px;height:30px;"></td>
			</tr>

			<tr>
				<td></td>
				<td><button  class="layui-btn layui-col-md-offset1" data-type="add"> 添加</button></td>
				<td> </td>
				<td></td>
				<td><button  class="layui-btn layui-col-md-offset1" data-type="gai"> 修改</button></td>
			</tr>			
		</tbody>
	</table>
</div>

<table class="layui-hide" id="LAY_table_user" lay-filter="test"></table>
<script type="text/html" id="barDemo">
    <a class="layui-btn-sm layui-btn-danger" lay-event="del">删除</a>
</script>


<div style="margin-bottom: 5px;">
    <ins class="adsbygoogle" style="display:inline-block;width:700px;height:485px" data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins>
</div>

<script>
	//JavaScript代码区域
	//config的设置是全局的
	layui.config({
	  base: '../layui/res/js/' //假设这是cookie.js所在的目录（本页面的相对路径）
	}).extend({ //设定模块别名
	  //cookie: 'cookie'   如果cookie.js是在根目录，也可以不用设定别名,因为我cookie.js的是在根目录，所以这句话其实也不用写也行。
	});

    layui.use(['jquery','cookie','table','layer','form'], function(){
        var $= layui.jquery
		,cookie= layui.cookie
		,form=layui.form
		,layer=layui.layer
		,table = layui.table;
		
		var myid=$.cookie('username');
		var key=$.cookie('key');
		
		form.on('select(yjleibie)', function(data)
		{
//			console.log('aaa');
			if(yjleibie.value!='')
			{
				$('#ejleibie').removeAttr('disabled');
				$("select[name='ejleibie']").html('<option value="">请选择</option>'); //清空
				$.ajax({
					type : "GET",
					url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
					data:{"action":"ejleibie","can_a":yjleibie.value,"id":myid,"key":key},
					dataType: "json",
					success: function(res)
					{
						for(var i=0; i<res.data.length; i++){
						$("select[name='ejleibie']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
						}
						form.render();
					}
				});				
			}
		});	

		form.on('select(shchsh)', function(data)
		{
			if(shchsh.value!='')
			{
				$('#pinpai').removeAttr('disabled');
				$("select[name='pinpai']").html('<option value="">请选择</option>'); //清空
				$.ajax({
					type : "GET",
					url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
					data:{"action":"pinpai","can_a":shchsh.value,"id":myid,"key":key},
					dataType: "json",
					success: function(res)
					{
						for(var i=0; i<res.data.length; i++){
						$("select[name='pinpai']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
						}
						form.render();
					}
				});				
			}
		});	
		
		form.on('select(pinpai)', function(data)
		{
			if(pinpai.value!='')
			{
				$('#xinghao').removeAttr('disabled');
				$("select[name='xinghao']").html('<option value="">请选择</option>'); //清空
				$.ajax({
					type : "GET",
					url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
					data:{"action":"xinghao","can_a":pinpai.value,"id":myid,"key":key},
					dataType: "json",
					success: function(res)
					{
						for(var i=0; i<res.data.length; i++){
						$("select[name='xinghao']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
						}
						form.render();
					}
				});				
			}
		});			

		form.on('select(yjleibie_a)', function(data)
		{
//			console.log('aaa');
			if(yjleibie_a.value!='')
			{
				$('#ejleibie_a').removeAttr('disabled');
				$("select[name='ejleibie_a']").html('<option value="">请选择</option>'); //清空
				$.ajax({
					type : "GET",
					url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
					data:{"action":"ejleibie","can_a":yjleibie_a.value,"id":myid,"key":key},
					dataType: "json",
					success: function(res)
					{
						for(var i=0; i<res.data.length; i++){
						$("select[name='ejleibie_a']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
						}
						form.render();
					}
				});				
			}
		});	

		form.on('select(shchsh_a)', function(data)
		{
			if(shchsh_a.value!='')
			{
				$('#pinpai_a').removeAttr('disabled');
				$("select[name='pinpai_a']").html('<option value="">请选择</option>'); //清空
				$.ajax({
					type : "GET",
					url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
					data:{"action":"pinpai","can_a":shchsh_a.value,"id":myid,"key":key},
					dataType: "json",
					success: function(res)
					{
						for(var i=0; i<res.data.length; i++){
						$("select[name='pinpai_a']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
						}
						form.render();
					}
				});				
			}
		});	
		
		form.on('select(pinpai_a)', function(data)
		{
			if(pinpai_a.value!='')
			{
				$('#xinghao_a').removeAttr('disabled');
				$("select[name='xinghao_a']").html('<option value="">请选择</option>'); //清空
				$.ajax({
					type : "GET",
					url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
					data:{"action":"xinghao","can_a":pinpai_a.value,"id":myid,"key":key},
					dataType: "json",
					success: function(res)
					{
						for(var i=0; i<res.data.length; i++){
						$("select[name='xinghao_a']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
						}
						form.render();
					}
				});				
			}
		});			


		
		$(document).ready(function(){
//			$("select[name='yjleibie']").html('<option value="">请选择</option>'); //清空
            $.ajax({
                type : "GET",
                url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
                data:{"action":"yjleibie","id":myid,"key":key},
				dataType: "json",
                success: function(res)
                {
					for(var i=0; i<res.data.length; i++){
					$("select[name='yjleibie']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
					}
					$.ajax({
						type : "GET",
						url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
						data:{"action":"shchsh","id":myid,"key":key},
						dataType: "json",
						success: function(res)
						{
							for(var i=0; i<res.data.length; i++){
							$("select[name='shchsh']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
							}
							form.render();
						  }
					});
				}
            });
//			$("select[name='shchsh']").html('<option value="">请选择</option>'); //清空
			parent.document.getElementById("option").height=0;
			parent.document.getElementById("option").height=document.body.scrollHeight;
        });
				
		table.render({
            elem: '#LAY_table_user'
            ,url: '/shiwuzichan/YW_chaxun/yw_base/?action=base&id=' + myid + '&key=' + key
            ,cols: [[
                {field: 'number', title: 'ID', width:80, sort: true, fixed: 'left'}
				,{field: 'name', title: '名称', width:200, sort: true}
				,{field: 'yjleibie', title: '一级类别', width:100} 
				,{field: 'ejleibie', title: '二级类别', width:100} 
				,{field: 'shchsh', title: '生产商', width:200}
				,{field: 'pinpai', title: '品牌/名称', width:120} 
				,{field: 'xinghao', title: '型号', width:120}
				,{field: 'beizhu', title: '备注', width: 300}
				,{field:'right', title: '操作', width:100,toolbar:"#barDemo"}
            ]]
            ,id: 'testReload'
            ,page: true
            ,height: 475
        });		
				
        var $ = layui.$, active = {
            add: function()
			{
//				console.log(zhriqi.value);
				if(mingcheng.value!='')
				{
					if(yjleibie.value!='')
					{
						if(ejleibie.value!='')
						{            
							if(shchsh.value!='')
							{
								if(pinpai.value!='')
								{
									if(xinghao.value!='')
									{            
									$.ajax({
										url: "/shiwuzichan/ZC_guanli/ZC_jiben/ZC_jiben/?beizhu=" + beizhu.value + "&name=" + mingcheng.value,
										type: "POST",
										data:{"yjleibie":yjleibie.value,"ejleibie":ejleibie.value,"shchsh":shchsh.value,"pinpai":pinpai.value,"xinghao":xinghao.value,"action":"add","id":myid,"key":key},
										dataType: "json",
										success: function(data){
						//					console.log(data.error.status);
											if(data.error.status == false){
													layer.msg("添加成功", {icon: 6});
												}
												else
												{
													if(data.error.code == 21)
														layer.msg(data.error.source, {icon: 5});
													else if(data.error.code == 20)
														layer.msg(data.error.source, {icon: 5});
													else
														layer.msg("添加失败", {icon: 5});
												}
												table.reload('testReload', {
												page: {
												  curr: 1 //重新从第 1 页开始
													}
												});	
											}
										});
									}
									else
									{
										layer.msg("请选择“型号”！", {icon: 5});
									}
								}
								else
								{
									layer.msg("请点击选择“品牌/名称”！", {icon: 5});
								}
							}
							else
							{
								layer.msg("请选择“生产商”！", {icon: 5});
							}
						}
						else
						{
							layer.msg("请选择“二级类别”！", {icon: 5});
						}
					}
					else
					{
						layer.msg("请选择“一级类别”！", {icon: 5});
					}
				}
				else
				{
					layer.msg("请填写“资产名称”！", {icon: 5});
				}
            },
            gai: function()
			{
//				console.log(zhriqi.value);
				if(mingcheng_a.value!='')
				{
					if(yjleibie_a.value!='')
					{
						if(ejleibie_a.value!='')
						{            
							if(shchsh_a.value!='')
							{
								if(pinpai_a.value!='')
								{
									if(xinghao_a.value!='')
									{            
									$.ajax({
										url: "/shiwuzichan/ZC_guanli/ZC_jiben/ZC_jiben/?beizhu=" + beizhu_a.value + "&name=" + mingcheng_a.value,
										type: "POST",
										data:{"number":zc_num.value,"yjleibie":yjleibie_a.value,"ejleibie":ejleibie_a.value,"shchsh":shchsh_a.value,"pinpai":pinpai_a.value,"xinghao":xinghao_a.value,"action":"gai","id":myid,"key":key},
										dataType: "json",
										success: function(data){
						//					console.log(data.error.status);
											if(data.error.status == false){
													layer.msg("修改成功", {icon: 6});
												}
												else
												{
													if(data.error.code == 21)
														layer.msg(data.error.source, {icon: 5});
													else if(data.error.code == 20)
														layer.msg(data.error.source, {icon: 5});
													else
														layer.msg("修改失败", {icon: 5});
												}
												table.reload('testReload', {
												page: {
												  curr: 1 //重新从第 1 页开始
													}
												});	
											}
										});
									}
									else
									{
										layer.msg("请选择“型号”！", {icon: 5});
									}
								}
								else
								{
									layer.msg("请点击选择“品牌/名称”！", {icon: 5});
								}
							}
							else
							{
								layer.msg("请选择“生产商”！", {icon: 5});
							}
						}
						else
						{
							layer.msg("请选择“二级类别”！", {icon: 5});
						}
					}
					else
					{
						layer.msg("请选择“一级类别”！", {icon: 5});
					}
				}
				else
				{
					layer.msg("请填写“资产名称”！", {icon: 5});
				}
            }			
        };
		
		
		table.on('row(test)', function(obj){
			var data = obj.data;
//			console.log(data);
			zc_num.value = data.number;		
			mingcheng_a.value=data.name;
/*			
			yjleibie_a.value=data.yjleibie;
			ejleibie_a.value=data.ejleibie;
			shchsh_a.value=data.shchsh;
			pinpai_a.value=data.pinpai;
			xinghao_a.value=data.xinghao;
*/			
			beizhu_a.value=data.beizhu;
			
			$("select[name='yjleibie_a']").html('<option value="">请选择一级类别</option>'); //清空
			$('#ejleibie_a').attr('disabled',true);
			$("select[name='ejleibie_a']").html('<option value="">请选择二级类别</option>'); //清空
			$("select[name='shchsh_a']").html('<option value="">请选择生产商</option>'); //清空
			$("select[name='pinpai_a']").html('<option value="">请选择品牌/名称</option>'); //清空
			$('#pinpai_a').attr('disabled',true);
			$("select[name='xinghao_a']").html('<option value="">请选择型号</option>'); //清空
			$('#xinghao_a').attr('disabled',true);
			
            $.ajax({
                type : "GET",
                url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
                data:{"action":"yjleibie","id":myid,"key":key},
				dataType: "json",
                success: function(res)
                {
					for(var i=0; i<res.data.length; i++){
					$("select[name='yjleibie_a']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
					}
//					$("#yjleibie_a").val(2);
//					form.render();
					$.ajax({
						type : "GET",
						url : "/shiwuzichan/YW_chaxun/yw_tongyong/",
						data:{"action":"shchsh","id":myid,"key":key},
						dataType: "json",
						success: function(res)
						{
							for(var i=0; i<res.data.length; i++){
							$("select[name='shchsh_a']").append("<option value='"+res.data[i].id+"'>"+res.data[i].name+"</option>");
							}
							form.render();
						  }
					});			
				  }
            });
			//标注选中样式
			obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
//			form.render();
		});		
		
        //监听工具条
        table.on('tool(test)', function(obj){
			console.log(zc_num.value);
            var data = obj.data;
			if(obj.event === 'del')
			{
                layer.confirm('确定删除？', function(index)
				{
                    console.log(data);
				$.ajax({
					url: "/shiwuzichan/ZC_guanli/ZC_jiben/ZC_jiben/",
					type: "POST",
					data:{"number":zc_num.value,"action":"del","id":myid,"key":key},
					dataType: "json",
					success: function(data){
		//					console.log(data.error.status);
							if(data.error.status == false)
							{
								layer.msg("删除成功", {icon: 6});
							}
							else
							{
								if(data.error.code == 21)
									layer.msg(data.error.source, {icon: 5});
								else if(data.error.code == 20)
									layer.msg(data.error.source, {icon: 5});
								else
									layer.msg("删除失败", {icon: 5});
							}
							table.reload('testReload', {
							page: {
							  curr: 1 //重新从第 1 页开始
								}
							});	
						}
					});
                });
            }
        });		
		
        
		$('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
</script>
</body>
</html>